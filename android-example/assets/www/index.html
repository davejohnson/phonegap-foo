<!DOCTYPE html>
<html>
  <head>
  <title></title>
  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
	<meta charset="utf-8">

	<!-- iPad/iPhone specific css below, add after your main css >
	<link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
	-->
    <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />

    <script type="text/javascript" charset="utf-8" src="cordova-1.7.0.js"></script>
    <script type="text/javascript" charset="utf-8" src="zepto.js"></script>
    <script type="text/javascript" charset="utf-8" src="handlebars.js"></script>
    <script type="text/javascript" charset="utf-8" src="hello.js"></script>
    <script type="text/javascript">

	/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
	see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
	for more details -jm */
	/*
	function handleOpenURL(url)
	{
		// TODO: do something with the url passed in.
	}
	*/

    var App = {
        getPub: function() {
            $.ajax({ url: 'http://api.untappd.com/v3/thepub?key=9976a03749c9d6b2b02c9b5d49de64e8'
                   , success: App.renderPub
                   , error: function() {alert('xhr error')} })
        },
        renderPub: function(data) {
            App.currentPubData = data
            document.body.innerHTML = (Handlebars.compile($('#pub-template').html()))(data)
            $('.checkin').on('click', App.getDetails, false);
        },
        getDetails: function(e) {
            $.ajax({ url: 'http://api.untappd.com/v3/details?key=9976a03749c9d6b2b02c9b5d49de64e8&id='+e.target.getAttribute('data-id')
                   , success: App.renderDetails
                   , error: function() {alert('xhr error')} })
        },
        renderDetails: function(data) {
            document.body.innerHTML = (Handlebars.compile($('#checkin-template').html()))(data)
        },
        sayHello: function() {
        	window.hello.say(function(data) {alert(data)}, function() {alert('error')})
        }
    }

    document.addEventListener("deviceready", App.getPub, false);
        
    </script>

	<script id="pub-template" type="text/x-handlebars-template">
        <div class=header>Untappd checkins</div>
        <div class=content>
            <ul>
                {{#each results}}
                    <li class=checkin data-id={{checkin_id}}>
                        {{#with user}}<img src={{user_avatar}}>{{/with}}
                        {{beer_name}}
                    </li>
                {{/each}}
            </ul>
        <div>
	</script>

    <script id="checkin-template" type="text/x-handlebars-template">
        <div class=header>Untappd checkin details</div>
        <div class=content>
            {{#with results}}
                <div class=checkin-details>
                    {{#with user}}<h2><img src={{user_avatar}}>{{first_name}} {{last_name}}</h2>{{/with}}
                    <h3>{{beer_name}} by {{brewery_name}}</h3>
                    <h4>{{toast_count}} toasts, rating {{avg_rating}}</h4>
                    <p>{{check_in_comment}}</p>
					<p><button onclick=App.sayHello()>say hello</button></p>
                </div>
            {{/with}}
        </div>
        </div>
    </script>
  </head>
  <body>
    <h1>Let's check out some beer.</h1>
  </body>
</html>
